<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>2020 Pollyanna</title>
    <link rel="stylesheet" 
	href="../styles/style.css">
	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>

	<!-- TODO: Add SDKs for Firebase products that you want to use
	     https://firebase.google.com/docs/web/setup#available-libraries -->
	<script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-analytics.js"></script>

	<script>
	  // Your web app's Firebase configuration
	  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
	  var firebaseConfig = {
	    apiKey: "AIzaSyCocgdDNI3VGJGJZ1G-2rdhYieqEgBGPzg",
	    authDomain: "pollyanna-2020.firebaseapp.com",
	    databaseURL: "https://pollyanna-2020.firebaseio.com",
	    projectId: "pollyanna-2020",
	    storageBucket: "pollyanna-2020.appspot.com",
	    messagingSenderId: "1015034849518",
	    appId: "1:1015034849518:web:d2d4cbde46efce2b3e6bff",
	    measurementId: "G-1V4B1SH6ES"
	  };
	  // Initialize Firebase
	  firebase.initializeApp(firebaseConfig);
	  firebase.analytics();
	</script>
	
	<script>

	var namesRef = firebase.database().ref().child('Names');
	
	function getName() {

		var formName = document.getElementById("nameIn").value;
		console.log("Getting name");
		console.log(formName);

		namesRef.once("value",function(snapshot) {
		if (snapshot.child(formName).child("Got").val()) {
			window.alert("You already have a name!");
		} else {
			var notTaken = [];
			snapshot.forEach(function(childSnapshot) {

				console.log(formName + " ? " + childSnapshot.key);
				
				if (formName != childSnapshot.key) {
					var taken = childSnapshot.child("Taken").val();
					if (!taken) {
						notTaken.push(childSnapshot.key);
					}
				}
			});

			randIdx = Math.floor(Math.random()*notTaken.length);
			newTaken = notTaken[randIdx];
			namesRef.child(newTaken).child("Taken").set(true);

			window.alert("Buy a gift for "+newTaken+" this year!");
			}
		});	
	}
	
	function openWinHome() {
	   window.location.href = "../";
	}
	</script>
  </head>
  <body>
	<div class="header">
		<ul>
			<li><input class= "buttonblast" target="home" type="button" value="Check out my personal webpage!" onclick="openWinHome()"></li>
			<li><img src="../images/buzz.jpeg" alt="buzz"/></li>
		</ul>
	</div>
   <center>
   <div class="homespacer">
   </div>
   <h2>2020 Holiday Pollyanna!</h2>
   <p>Select your name and receive your gift receipient</p>
   <br/>
	<form id="rsvpForm">
		<input list="names" id="nameIn">
		  <datalist id="names">
		    <option value="Olivia">
		    <option value="Sophia">
		    <option value="Jacob">
		    <option value="Noah">
		    <option value="Alexis">
		  </datalist>
		<br/>
		<br/>
		<input class= "buttonblast" target="submit" type="button" value="Get Name!" onclick="getName()">
	</form>
   </center>
   </body>
</html>